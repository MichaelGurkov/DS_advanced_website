---
title: "Transformations"
---

```{r set_up_python, echo=FALSE}
#|echo: FALSE

if (Sys.getenv("USERPROFILE") == "C:\\Users\\internet"){
  
  python_path = paste0("C:\\Users\\internet\\AppData\\Local",
                       "\\Programs\\Python\\Python312\\python.exe")
} else {
  
  python_path = paste0("C:\\Users\\Home\\AppData\\Local",
                       "\\Programs\\Python\\Python312\\python.exe")
}

reticulate::use_python(python_path)

```

```{python}

import numpy as np

import pandas as pd

import matplotlib.pyplot as plt

import os 

```

```{python import_data}

file_path = os.path.expanduser("~/Documents") + "\\DS_advanced_website\\data\\example_air_passengers.csv"

raw_df = pd.read_csv(file_path,index_col = "date")

raw_df.index = pd.to_datetime(raw_df.index)

```

```{python}

raw_df["passengers"].plot()

plt.tight_layout()

plt.show()

```

## Log transformation

++ explain that sometimes we want to transform a features, for example in order to stabilize the variance

```{python plot_log}

raw_df["passengers_log"] = np.log(raw_df["passengers"])

plt.clf()

raw_df["passengers_log"].plot()

plt.tight_layout()

plt.show()



```

## Box Cox transformation

```{python}

from sktime.transformations.series.boxcox import BoxCoxTransformer

lambdas_vec = [-1,-0.5,0,0.5,1,2]

plt.clf()

fig,ax = plt.subplots(ncols = 2, nrows = 3,figsize=[25, 15], sharex = True)

ax = ax.flatten()

for ix, temp_lambda in enumerate(lambdas_vec):
  print(temp_lambda)
  
  bc_trans = BoxCoxTransformer(lambda_fixed = temp_lambda)
  
  raw_df["temp_box_cox"] = bc_trans.fit_transform(raw_df["passengers"])
  
  raw_df.plot(y = "temp_box_cox",ax  = ax[ix], label = f"lambda = {temp_lambda}")
  
  ax[ix].legend()
  
  ax[ix].set_xlabel("")
  

plt.tight_layout()
  
plt.show()


```

### The Guerrero methond
++ explain briefly the Guerrero method. Emphasize that it's advantage is the explicit focus on stabilization of variance.


```{python guerrero_method}

from sktime.transformations.series.boxcox import BoxCoxTransformer

bc_guerrero = BoxCoxTransformer(method = "guerrero", sp = 12)

raw_df["passengers_bc_guerrero"] = bc_guerrero.fit_transform(raw_df["passengers"])

plt.clf()

raw_df["passengers_bc_guerrero"].plot()

plt.tight_layout()

plt.show()


```
